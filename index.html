<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free flash AI | Calm Study Environment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <!-- Firebase Libraries (CDN Modules) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // Your specific Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDq2eQF3ZMhXmCDZUVuyolh-fuIXF5lLRs",
            authDomain: "free-flash-14603.firebaseapp.com",
            projectId: "free-flash-14603",
            storageBucket: "free-flash-14603.firebasestorage.app",
            messagingSenderId: "405766477947",
            appId: "1:405766477947:web:12eed4eca909e8eb9d2ade"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        window.firebaseAuth = auth;

        // Global state for Auth
        window.userState = null;

        onAuthStateChanged(auth, (user) => {
            if (user) {
                window.userState = {
                    email: user.email,
                    photo: user.photoURL || `https://ui-avatars.com/api/?name=${user.email || 'User'}&background=8e94f2&color=fff`,
                };
                document.getElementById('login-btn-container').classList.add('hidden');
                document.getElementById('logout-btn-container').classList.remove('hidden');
                document.getElementById('profile-card').classList.remove('hidden');
            } else {
                window.userState = null;
                document.getElementById('login-btn-container').classList.remove('hidden');
                document.getElementById('logout-btn-container').classList.add('hidden');
                document.getElementById('profile-card').classList.add('hidden');
            }
            updateProfileUI();
            if (typeof window.refreshLibraryState === 'function') window.refreshLibraryState();
        });

        function updateProfileUI() {
            const emailEl = document.getElementById('user-email');
            const imgEl = document.getElementById('user-avatar');
            if (window.userState) {
                if (emailEl) emailEl.innerText = window.userState.email;
                if (imgEl) imgEl.src = window.userState.photo;
            }
        }

        window.handleGoogleLogin = async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
                showToast("Welcome back!");
            } catch (e) {
                showToast("Login failed. Please try again.");
            }
        };

        window.handleLogout = async () => {
            try {
                await signOut(auth);
                window.location.reload(); 
            } catch (e) {
                showToast("Error logging out");
            }
        };
    </script>

    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            --text-main: #2d3436;
            --text-muted: #636e72;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --card-bg: #ffffff;
            --card-border: #f0f0f0;
            --accent: #8e94f2;
        }

        .dark-mode {
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --glass-bg: rgba(30, 41, 59, 0.7);
            --card-bg: #1e293b;
            --card-border: #334155;
            --accent: #a5b4fc;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-gradient);
            height: 100vh;
            color: var(--text-main);
            overflow: hidden; 
            transition: background 0.3s ease, color 0.3s ease;
        }

        .scrollable-content {
            overflow-y: auto;
            max-height: calc(100vh - 180px);
            scrollbar-width: none;
        }
        .scrollable-content::-webkit-scrollbar { display: none; }

        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
        }

        .flashcard-container {
            perspective: 1000px;
            width: 100%;
            max-width: 450px;
            height: 350px;
            cursor: pointer;
        }

        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .flashcard-container.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }

        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2.5rem;
            border-radius: 24px;
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            color: var(--text-main);
        }

        .flashcard-back {
            transform: rotateY(180deg);
            background: var(--glass-bg);
            border-color: var(--accent);
        }

        .hint-text {
            position: absolute;
            bottom: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent);
            opacity: 0.6;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }

        .btn-gradient {
            background: linear-gradient(90deg, #8e94f2, #bbadff);
            transition: all 0.3s ease;
        }

        .nav-item { transition: all 0.3s ease; color: #94a3b8; }
        .nav-item.active { color: var(--accent); transform: translateY(-4px); }

        #loading-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: var(--bg-gradient);
            z-index: 100;
            backdrop-filter: blur(8px);
        }

        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid var(--accent);
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .page-transition { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px; width: 18px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(24px); }
    </style>
</head>
<body id="app-body">

    <div id="loading-overlay" class="flex flex-col items-center justify-center">
        <span class="loader mb-4"></span>
        <p class="font-bold animate-pulse" style="color: var(--accent)">Processing your knowledge...</p>
    </div>

    <div class="max-w-4xl mx-auto px-4 h-full flex flex-col">
        
        <!-- Create Section -->
        <section id="view-create" class="page-transition flex-1 flex flex-col justify-center py-4">
            <header class="text-center mb-6">
                <h1 class="text-4xl md:text-5xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-indigo-400 to-purple-500 mb-2">Free flash AI</h1>
                <p style="color: var(--text-muted)" class="text-sm">Distill any source into smart study cards.</p>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-1 glass p-5 h-fit">
                    <h2 class="font-bold text-lg mb-3">Configure</h2>
                    <label class="block text-xs font-semibold mb-2 uppercase tracking-wider opacity-60">Deck Size</label>
                    <input type="range" id="cardCount" min="1" max="20" value="5" class="w-full h-2 bg-indigo-100 rounded-lg appearance-none cursor-pointer mb-2">
                    <div class="text-center font-bold text-indigo-400" id="cardCountVal">5 Cards</div>
                </div>

                <div class="lg:col-span-2 glass p-6">
                    <div class="flex gap-6 mb-6 border-b border-gray-100/10 pb-2">
                        <button onclick="switchInput('file')" id="tab-file" class="font-bold border-b-2 border-indigo-400 pb-1" style="color: var(--accent)">PDF</button>
                        <button onclick="switchInput('image')" id="tab-image" class="text-slate-400 font-bold hover:text-indigo-400 transition-colors">Image</button>
                        <button onclick="switchInput('text')" id="tab-text" class="text-slate-400 font-bold hover:text-indigo-400 transition-colors">Text</button>
                    </div>

                    <div id="input-file">
                        <input type="file" id="fileInput" accept=".pdf" class="hidden">
                        <label for="fileInput" class="flex flex-col items-center justify-center p-8 border-2 border-dashed border-indigo-200/50 rounded-3xl cursor-pointer hover:bg-indigo-50/5 transition-all">
                            <svg class="w-12 h-12 text-indigo-300 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            <span id="fileName" class="font-bold text-center text-sm">Tap to upload PDF<br><small class="font-normal opacity-60">(Max 15 pages)</small></span>
                        </label>
                    </div>

                    <div id="input-image" class="hidden">
                        <input type="file" id="imageInput" accept="image/*" class="hidden">
                        <label for="imageInput" class="flex flex-col items-center justify-center p-8 border-2 border-dashed border-purple-200/50 rounded-3xl cursor-pointer hover:bg-purple-50/5 transition-all">
                            <svg class="w-12 h-12 text-purple-300 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path></svg>
                            <span id="imageName" class="font-bold text-sm">Capture or Upload Image</span>
                        </label>
                    </div>

                    <div id="input-text" class="hidden">
                        <textarea id="textContent" placeholder="Paste study notes..." class="w-full h-32 p-4 rounded-3xl border-none focus:ring-2 focus:ring-indigo-200 outline-none resize-none bg-slate-100/10 text-sm"></textarea>
                    </div>

                    <button onclick="generateFlashcards()" class="w-full btn-gradient mt-6 py-4 rounded-3xl text-white font-bold shadow-xl text-md hover:scale-[1.02]">Create Your Deck</button>
                </div>
            </div>
        </section>

        <!-- Library Section -->
        <section id="view-library" class="hidden page-transition flex-1 py-8">
            <header class="text-center mb-6">
                <h1 class="text-4xl font-extrabold mb-1">My Library</h1>
                <p style="color: var(--text-muted)">Access your active study sessions</p>
            </header>
            
            <div class="scrollable-content px-2">
                <!-- Auth Required Prompt -->
                <div id="library-auth-required" class="glass p-16 text-center">
                    <div class="w-16 h-16 bg-red-100/20 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m0 0v2m0-2h2m-2 0H10m4-8l-2-2m0 0l-2 2m2-2v6"></path></svg>
                    </div>
                    <p class="text-slate-400 font-bold mb-4">Login required to view library</p>
                    <button onclick="navigateTo('setting')" class="px-6 py-2 bg-indigo-500 text-white rounded-full font-bold text-sm">Go to Settings</button>
                </div>

                <div id="library-empty" class="glass p-16 text-center hidden">
                    <p class="text-slate-400 font-medium">No decks found. Start by creating one!</p>
                </div>

                <div id="library-content" class="hidden grid grid-cols-1 gap-4">
                    <div class="glass p-6 flex items-center justify-between hover:bg-white/5 cursor-pointer transition-all border-l-8 border-indigo-400" onclick="navigateTo('study')">
                        <div class="flex items-center gap-5">
                            <div class="w-14 h-14 bg-indigo-100/10 rounded-2xl flex items-center justify-center text-indigo-400">
                                <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 20 20"><path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"></path></svg>
                            </div>
                            <div>
                                <h3 class="font-bold text-lg" id="lib-deck-title">Active Study Deck</h3>
                                <p class="text-sm opacity-60" id="lib-deck-count">0 Cards</p>
                            </div>
                        </div>
                        <svg class="w-6 h-6 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </div>
                </div>
            </div>
        </section>

        <!-- Setting Section -->
        <section id="view-setting" class="hidden page-transition flex-1 flex flex-col justify-center py-8">
            <header class="text-center mb-6">
                <h1 class="text-4xl font-extrabold mb-2">Settings</h1>
            </header>

            <div class="space-y-4 max-w-lg mx-auto w-full">
                <!-- Profile Card -->
                <div id="profile-card" class="glass p-6 flex items-center gap-6 hidden">
                    <img id="user-avatar" src="" class="w-16 h-16 rounded-full border-4 border-white/20 shadow-lg object-cover">
                    <div>
                        <h3 class="text-[10px] font-bold uppercase tracking-widest text-indigo-400 mb-1">Signed in as</h3>
                        <p id="user-email" class="text-lg font-bold truncate max-w-[150px] md:max-w-none">User</p>
                    </div>
                </div>

                <!-- Appearance -->
                <div class="glass p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="font-bold text-md">Dark Mode</h3>
                            <p class="text-xs opacity-60">Easier on the eyes for night study</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="theme-toggle" onchange="toggleTheme()">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Contact Support -->
                <div class="glass p-6">
                    <h3 class="font-bold text-md mb-3">Support & Feedback</h3>
                    <a href="https://wa.me/918229084161" target="_blank" class="flex items-center justify-between p-4 bg-green-500/10 rounded-2xl border border-green-500/20 hover:bg-green-500/20 transition-all group">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-green-500 rounded-xl text-white">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.414 0 .018 5.393 0 12.03c0 2.123.554 4.197 1.604 6.046L0 24l6.126-1.606a11.77 11.77 0 005.918 1.605h.006c6.635 0 12.032-5.394 12.035-12.033a11.796 11.796 0 00-3.526-8.412z"/></svg>
                            </div>
                            <div class="text-sm">
                                <p class="font-bold">WhatsApp Support</p>
                                <p class="opacity-60 text-xs">8229084161</p>
                            </div>
                        </div>
                        <svg class="w-5 h-5 text-green-500 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                    </a>
                </div>

                <!-- Login Button Container -->
                <div id="login-btn-container" class="w-full">
                    <button onclick="window.handleGoogleLogin()" class="w-full p-4 glass border-indigo-500/20 hover:bg-indigo-500/5 text-indigo-500 font-bold transition-all flex items-center justify-center gap-3">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12.48 10.92v3.28h7.84c-.24 1.84-1.92 5.36-7.84 5.36-5.12 0-9.28-4.24-9.28-9.52s4.16-9.52 9.28-9.52c2.92 0 4.88 1.24 6 2.32l2.6-2.6C18.88 1.28 15.96 0 12.48 0 5.56 0 0 5.56 0 12.48s5.56 12.48 12.48 12.48c7.24 0 12.04-5.08 12.04-12.24 0-.84-.08-1.48-.2-2.12h-11.84z"/></svg>
                        Login with Google
                    </button>
                </div>

                <!-- Log Out Button Container -->
                <div id="logout-btn-container" class="w-full hidden">
                    <button onclick="window.handleLogout()" class="w-full p-4 glass border-red-500/20 hover:bg-red-500/5 text-red-500 font-bold transition-all flex items-center justify-center gap-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                        Log Out
                    </button>
                </div>
            </div>
        </section>

        <!-- Study View -->
        <section id="view-study" class="hidden page-transition flex-1 flex flex-col justify-center py-4">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('library')" class="p-2 hover:bg-white/10 rounded-2xl transition-all">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                </button>
                <h2 class="text-xl font-bold">Study Session</h2>
            </div>

            <div class="flex flex-col items-center">
                <div id="flashcard-wrapper" class="flashcard-container" onclick="this.classList.toggle('flipped')">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <p id="card-question" class="text-xl font-semibold leading-relaxed text-center"></p>
                            <div class="hint-text">Tap to reveal</div>
                        </div>
                        <div class="flashcard-back">
                            <p id="card-answer" class="text-lg leading-relaxed text-center"></p>
                        </div>
                    </div>
                </div>

                <div class="w-full max-w-[450px] mt-8 space-y-4">
                    <div class="flex justify-between items-center text-[10px] font-bold text-indigo-400 tracking-widest uppercase">
                        <span id="progress-text">Card 1 of 5</span>
                        <div class="flex gap-3">
                            <button onclick="prevCard()" class="p-3 glass hover:shadow-lg transition-all">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            </button>
                            <button onclick="nextCard()" class="p-3 glass hover:shadow-lg transition-all">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                        </div>
                    </div>
                    <div class="w-full bg-slate-200/20 rounded-full h-2 overflow-hidden shadow-inner">
                        <div id="progress-bar" class="bg-gradient-to-r from-indigo-400 to-purple-400 h-full transition-all duration-500" style="width: 20%"></div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Bottom Navigation Bar -->
    <nav class="fixed bottom-0 left-0 right-0 glass m-4 mb-6 shadow-2xl z-50 py-3 px-10 flex justify-between items-center max-w-lg mx-auto border border-white/10">
        <button onclick="navigateTo('create')" id="nav-create" class="nav-item active flex flex-col items-center gap-1">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
            <span class="text-[8px] font-bold uppercase tracking-widest">Create</span>
        </button>
        <button onclick="navigateTo('library')" id="nav-library" class="nav-item flex flex-col items-center gap-1">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
            <span class="text-[8px] font-bold uppercase tracking-widest">Library</span>
        </button>
        <button onclick="navigateTo('setting')" id="nav-setting" class="nav-item flex flex-col items-center gap-1">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg>
            <span class="text-[8px] font-bold uppercase tracking-widest">Setting</span>
        </button>
    </nav>

    <script>
        // Integrated your Gemini API Key
        const apiKey = "AIzaSyDFy2jxO7vAK5cAh3d6gPE7qBwR7ZwFBYA"; 
        
        let currentMode = 'file';
        window.flashcards = [];
        let currentIndex = 0;
        let pdfText = "";

        function toggleTheme() {
            const isDark = document.getElementById('theme-toggle').checked;
            document.getElementById('app-body').className = isDark ? 'dark-mode' : '';
        }

        function navigateTo(view) {
            document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const target = document.getElementById(`view-${view}`);
            if (target) target.classList.remove('hidden');
            const navId = (view === 'study') ? 'nav-library' : `nav-${view}`;
            const navEl = document.getElementById(navId);
            if (navEl) navEl.classList.add('active');
            
            if (view === 'library') window.refreshLibraryState();
        }

        document.getElementById('cardCount').addEventListener('input', (e) => {
            document.getElementById('cardCountVal').innerText = `${e.target.value} Cards`;
        });

        function switchInput(mode) {
            currentMode = mode;
            ['file', 'image', 'text'].forEach(m => {
                document.getElementById(`input-${m}`).classList.add('hidden');
                document.getElementById(`tab-${m}`).className = "text-slate-400 font-bold hover:text-indigo-400 transition-colors";
            });
            document.getElementById(`input-${mode}`).classList.remove('hidden');
            document.getElementById(`tab-${mode}`).className = "font-bold border-b-2 border-indigo-400 pb-1";
            document.getElementById(`tab-${mode}`).style.color = "var(--accent)";
        }

        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('fileName').innerText = file.name;
                const reader = new FileReader();
                reader.onload = async function() {
                    const typedarray = new Uint8Array(this.result);
                    const pdf = await pdfjsLib.getDocument(typedarray).promise;
                    let fullText = "";
                    const maxPages = Math.min(pdf.numPages, 15);
                    for (let i = 1; i <= maxPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        fullText += textContent.items.map(s => s.str).join(' ') + "\n";
                    }
                    pdfText = fullText;
                };
                reader.readAsArrayBuffer(file);
            }
        });

        document.getElementById('imageInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) document.getElementById('imageName').innerText = file.name;
        });

        async function fetchWithRetry(url, options, maxRetries = 5) {
            let delay = 1000;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return await response.json();
                    if (response.status === 429 || (response.status >= 500 && response.status < 600)) {
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2; continue;
                    }
                    throw new Error((await response.json()).error?.message || "Request failed");
                } catch (err) {
                    if (i === maxRetries - 1) throw err;
                    await new Promise(res => setTimeout(res, delay));
                    delay *= 2;
                }
            }
        }

        async function generateFlashcards() {
            const count = document.getElementById('cardCount').value;
            document.getElementById('loading-overlay').style.display = 'flex';
            try {
                let prompt = `Analyze content and create exactly ${count} study flashcards. Return ONLY a JSON array: [{"question": "...", "answer": "..."}]`;
                let body = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { responseMimeType: "application/json" }
                };
                if (currentMode === 'file') {
                    if (!pdfText) throw new Error("Please upload a PDF first.");
                    body.contents[0].parts.push({ text: `Source Material:\n${pdfText}` });
                } else if (currentMode === 'text') {
                    const text = document.getElementById('textContent').value;
                    if (!text) throw new Error("Please enter some text.");
                    body.contents[0].parts.push({ text: `Source Material:\n${text}` });
                } else if (currentMode === 'image') {
                    const fileInput = document.getElementById('imageInput');
                    if (fileInput.files.length === 0) throw new Error("Please select an image.");
                    const reader = new FileReader();
                    const base64Promise = new Promise(resolve => {
                        reader.onload = () => resolve(reader.result);
                        reader.readAsDataURL(fileInput.files[0]);
                    });
                    const base64Image = await base64Promise;
                    body.contents[0].parts.push({ inlineData: { mimeType: fileInput.files[0].type, data: base64Image.split(',')[1] } });
                }

                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                const data = await fetchWithRetry(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                window.flashcards = JSON.parse(data.candidates[0].content.parts[0].text);
                
                document.getElementById('lib-deck-count').innerText = `${window.flashcards.length} Cards`;
                currentIndex = 0;
                navigateTo('study');
                updateCardUI();
            } catch (err) { showToast(err.message); }
            finally { document.getElementById('loading-overlay').style.display = 'none'; }
        }

        window.refreshLibraryState = function() {
            const emptyLib = document.getElementById('library-empty');
            const authPrompt = document.getElementById('library-auth-required');
            const libContent = document.getElementById('library-content');

            if (!window.userState) {
                emptyLib.classList.add('hidden');
                libContent.classList.add('hidden');
                authPrompt.classList.remove('hidden');
            } else {
                authPrompt.classList.add('hidden');
                if (window.flashcards && window.flashcards.length > 0) {
                    libContent.classList.remove('hidden');
                    emptyLib.classList.add('hidden');
                } else {
                    emptyLib.classList.remove('hidden');
                    libContent.classList.add('hidden');
                }
            }
        }

        function updateCardUI() {
            const card = window.flashcards[currentIndex];
            document.getElementById('flashcard-wrapper').classList.remove('flipped');
            setTimeout(() => {
                document.getElementById('card-question').innerText = card.question;
                document.getElementById('card-answer').innerText = card.answer;
                const progress = ((currentIndex + 1) / window.flashcards.length) * 100;
                document.getElementById('progress-bar').style.width = `${progress}%`;
                document.getElementById('progress-text').innerText = `Card ${currentIndex + 1} of ${window.flashcards.length}`;
            }, 100);
        }

        function nextCard() { if (currentIndex < window.flashcards.length - 1) { currentIndex++; updateCardUI(); } }
        function prevCard() { if (currentIndex > 0) { currentIndex--; updateCardUI(); } }

        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = "fixed bottom-24 left-1/2 -translate-x-1/2 bg-red-500 text-white px-8 py-4 rounded-3xl shadow-2xl z-[100] font-bold";
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }
    </script>
</body>
</html>

